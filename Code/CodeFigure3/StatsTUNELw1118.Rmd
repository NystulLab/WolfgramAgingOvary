---
title: "StatsTUNELw1118"
output: html_document
date: "2026-01-22"
editor_options: 
  chunk_output_type: console
---

Set-up
```{r}
library(lme4)
library(dplyr)
library(broom.mixed)
```

```{r}
getwd()
```

Load data
```{r}
tunelstats <- read_csv("Data/DataFigure3/w1118TUNELAll.csv")
```

##Stats for TUNEL on Fas3 border in 1 vs 6 weeks w1118
```{r}
tunelfas31v6_avg <- tunelstats %>%
  group_by(N, Weeks) %>%
  summarize(
    TUNELFas3 = mean(TUNELFas3),
    .groups = "drop"
  ) %>%
  mutate(
    Weeks = factor(Weeks)
  )

ttest_tunel1v6avg <- t.test(
  TUNELFas3 ~ Weeks,
  data = tunelfas31v6_avg,
  var.equal = FALSE
)

p_val <- ttest_tunel1v6avg$p.value

stars <- case_when(
  p_val < 0.001 ~ "***",
  p_val < 0.01  ~ "**",
  p_val < 0.05  ~ "*",
  TRUE          ~ "ns"
)

tunelfas31v6_ttest <- data.frame(
  comparison = "6 Weeks",
  p_value = p_val,
  stars = stars
)

print(tunelfas31v6_ttest)
```

```{r}
write.csv(
  tunelfas31v6_ttest,
  "Results/ResultsFigure3/StatsTUNELFas31v6ttest.csv",
  row.names = FALSE
)
```


##Stats for TUNEL on Fas3 border in 6 weeks, no phenotype vs phenotype

Load data
```{r}
tunelstats <- read_csv("Data/DataFigure3/w1118TUNELAll.csv")
```

```{r}
tunel6wk <- tunelstats %>%
  filter(Weeks == 6) %>%
  mutate(
    Phenotype = factor(Phenotype),
    N = factor(N)
  )

tunel_glmm <- glmer(
  TUNELFas3 ~ Phenotype + (1 | N),
  data = tunel6wk,
  family = binomial(link = "logit")
)

tunel_summary <- summary(tunel_glmm)

# Extract fixed-effect stats (Phenotype 1 vs 0)
coef_row <- tunel_summary$coefficients["Phenotype1", ]

glmm_tunel <- data.frame(
  term = "Phenotype",
  estimate_log_odds = coef_row["Estimate"],
  std_error = coef_row["Std. Error"],
  z_value = coef_row["z value"],
  p_value = coef_row["Pr(>|z|)"],
  odds_ratio = exp(coef_row["Estimate"])
)

glmm_tunel$stars <- ifelse(
  glmm_tunel$p_value < 0.001, "***",
  ifelse(glmm_tunel$p_value < 0.01, "**",
         ifelse(glmm_tunel$p_value < 0.05, "*", "ns"))
)

print(glmm_tunel)
```

```{r}
write.csv(
  glmm_tunel,
  "Results/ResultsFigure3/StatsTUNELFas36wkNovsPhenoGlmm.csv",
  row.names = FALSE
)
```


##Stats for Phenotype penetrance for 1 vs 6 weeks in No Lysotracker Band Condition 

Load data
```{r}
lysostats <- read_csv("Data/DataFigure3/w1118LysotrackerAll.csv")
```

```{r}
pheno_noband_avg <- lysostats %>%
  filter(LysoFas3 == 0) %>%
  group_by(N, Weeks) %>%
  summarize(
    Phenotype = mean(Phenotype),
    .groups = "drop"
  ) %>%
  mutate(
    Weeks = factor(Weeks)
  )

ttest_pheno1v6noband <- t.test(
  Phenotype ~ Weeks,
  data = pheno_noband_avg,
  var.equal = FALSE
)

p_val <- ttest_pheno1v6noband$p.value

stars <- case_when(
  p_val < 0.001 ~ "***",
  p_val < 0.01  ~ "**",
  p_val < 0.05  ~ "*",
  TRUE          ~ "ns"
)

ttest_lyso1v6avg_df <- data.frame(
  comparison = "6 Weeks",
  p_value = p_val,
  stars = stars
)

print(ttest_lyso1v6avg_df)
```

```{r}
write.csv(
  ttest_lyso1v6avg_df,
  "Results/ResultsFigure3/StatsPhenoNoLyso1v6ttest.csv",
  row.names = FALSE
)
```